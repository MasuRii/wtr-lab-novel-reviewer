// ==UserScript==
// @name WTR-Lab Novel Reviewer
// @description Analyzes novels on wtr-lab.com using Gemini AI to provide comprehensive assessments including character development, plot structure, world-building, themes & messages, and writing style.
// @version 1.8.4
// @author MasuRii
// @supportURL https://github.com/MasuRii/wtr-lab-novel-reviewer/issues
// @match https://wtr-lab.com/en/for-you
// @match https://wtr-lab.com/en/for-you?*
// @connect generativelanguage.googleapis.com
// @connect fonts.googleapis.com
// @downloadURL https://raw.githubusercontent.com/MasuRii/wtr-lab-novel-reviewer/main/dist/wtr-lab-novel-reviewer.user.js
// @grant GM_setValue
// @grant GM_getValue
// @grant GM_addStyle
// @grant GM_registerMenuCommand
// @grant GM_xmlhttpRequest
// @grant GM_getResourceText
// @icon https://www.google.com/s2/favicons?sz=64&domain=wtr-lab.com
// @license MIT
// @namespace http://tampermonkey.net/
// @run-at document-idle
// @updateURL https://raw.githubusercontent.com/MasuRii/wtr-lab-novel-reviewer/main/dist/wtr-lab-novel-reviewer.user.js
// @website https://github.com/MasuRii/wtr-lab-novel-reviewer
// ==/UserScript==

(()=>{"use strict";var n={41:(n,t,e)=>{e.d(t,{A:()=>s});var i=e(601),o=e.n(i),a=e(314),r=e.n(a)()(o());r.push([n.id,"/* Mobile considerations */\n@media (width <= 768px) {\n\t.gemini-summary-card {\n\t\tposition: fixed;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\twidth: 90%;\n\t\tmax-width: 400px;\n\t\tmax-height: 80vh;\n\t\tz-index: 1000;\n\t}\n\n\t#gemini-api-key-modal {\n\t\twidth: 95%;\n\t\tpadding: 15px;\n\t}\n\n\t#gemini-api-key-modal .buttons {\n\t\tflex-direction: column;\n\t\tgap: 10px;\n\t}\n\n\t#gemini-api-key-modal button {\n\t\twidth: 100%;\n\t\tmargin: 0;\n\t}\n\n\t/* Settings Panel responsive design */\n\t#gemini-settings-panel {\n\t\twidth: 95%;\n\t\tmax-width: none;\n\t\tpadding: 15px;\n\t}\n\n\t#gemini-settings-panel .buttons {\n\t\tflex-direction: column;\n\t\talign-items: stretch;\n\t\tgap: 10px;\n\t}\n\n\t#gemini-settings-panel .clear-cache-btn {\n\t\tmargin-right: 0;\n\t\torder: 2;\n\t\twidth: 100%;\n\t}\n\n\t#gemini-settings-panel .buttons button:not(.clear-cache-btn) {\n\t\twidth: 100%;\n\t\tmargin-left: 0;\n\t}\n\n\t#gemini-mapping-failure-notification {\n\t\twidth: calc(100% - 40px);\n\t\tright: 20px;\n\t\tleft: 20px;\n\t}\n}\n\n/* Extra small screens */\n@media (width <= 600px) {\n\t#gemini-settings-panel {\n\t\twidth: 98%;\n\t\tpadding: 12px;\n\t}\n\n\t#gemini-settings-panel .buttons {\n\t\tgap: 8px;\n\t}\n\n\t#gemini-settings-panel button {\n\t\tpadding: 10px 12px;\n\t\tfont-size: 14px;\n\t}\n\n\t#gemini-api-key-modal {\n\t\twidth: 98%;\n\t\tpadding: 12px;\n\t}\n\n\t#gemini-api-key-modal .buttons {\n\t\tgap: 8px;\n\t}\n\n\t#gemini-api-key-modal button {\n\t\tpadding: 10px 12px;\n\t\tfont-size: 14px;\n\t}\n}\n",""]);const s=r},56:(n,t,e)=>{n.exports=function(n){var t=e.nc;t&&n.setAttribute("nonce",t)}},72:n=>{var t=[];function e(n){for(var e=-1,i=0;i<t.length;i++)if(t[i].identifier===n){e=i;break}return e}function i(n,i){for(var a={},r=[],s=0;s<n.length;s++){var l=n[s],c=i.base?l[0]+i.base:l[0],d=a[c]||0,m="".concat(c," ").concat(d);a[c]=d+1;var g=e(m),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==g)t[g].references++,t[g].updater(p);else{var u=o(p,i);i.byIndex=s,t.splice(s,0,{identifier:m,updater:u,references:1})}r.push(m)}return r}function o(n,t){var e=t.domAPI(t);return e.update(n),function(t){if(t){if(t.css===n.css&&t.media===n.media&&t.sourceMap===n.sourceMap&&t.supports===n.supports&&t.layer===n.layer)return;e.update(n=t)}else e.remove()}}n.exports=function(n,o){var a=i(n=n||[],o=o||{});return function(n){n=n||[];for(var r=0;r<a.length;r++){var s=e(a[r]);t[s].references--}for(var l=i(n,o),c=0;c<a.length;c++){var d=e(a[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}a=l}}},113:n=>{n.exports=function(n,t){if(t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}},193:(n,t,e)=>{e.d(t,{A:()=>s});var i=e(601),o=e.n(i),a=e(314),r=e.n(a)()(o());r.push([n.id,"/* Color coding for assessment ratings */\n.assessment-rating {\n\tfont-weight: bold;\n\tpadding: 2px 6px;\n\tborder-radius: 3px;\n}\n\n.assessment-rating.good {\n\tcolor: #4caf50;\n\tbackground-color: rgb(76 175 80 / 10%);\n}\n\n.assessment-rating.mixed {\n\tcolor: #ff9800;\n\tbackground-color: rgb(255 152 0 / 10%);\n}\n\n.assessment-rating.bad {\n\tcolor: #f44336;\n\tbackground-color: rgb(244 67 54 / 10%);\n}\n\n.assessment-rating.unknown {\n\tcolor: #9e9e9e;\n\tbackground-color: rgb(158 158 158 / 10%);\n\tborder: 1px solid rgb(158 158 158 / 30%);\n\tfont-style: italic;\n}\n",""]);const s=r},229:(n,t,e)=>{e.d(t,{A:()=>s});var i=e(601),o=e.n(i),a=e(314),r=e.n(a)()(o());r.push([n.id,"/* Base stylesheet for WTR-Lab Novel Reviewer */\n\n/* Keyframe animations */\n@keyframes slide-in-right {\n\tfrom {\n\t\ttransform: translateX(100%);\n\t\topacity: 0;\n\t}\n\n\tto {\n\t\ttransform: translateX(0);\n\t\topacity: 1;\n\t}\n}\n\n/* Utility classes */\n.material-icons {\n\t/* Inherit from vendor/_material-icons.css */\n}\n",""]);const s=r},279:(n,t,e)=>{e.d(t,{A:()=>s});var i=e(601),o=e.n(i),a=e(314),r=e.n(a)()(o());r.push([n.id,"/* Mapping Failure Notification */\n#gemini-mapping-failure-notification {\n\tposition: fixed;\n\ttop: 80px;\n\tright: 20px;\n\twidth: 400px;\n\tbackground-color: #dc3545;\n\tcolor: white;\n\tborder-radius: 8px;\n\tbox-shadow: 0 6px 16px rgb(0 0 0 / 40%);\n\tz-index: 10000;\n\tanimation: slide-in-right 0.3s ease-out;\n}\n\n#gemini-mapping-failure-notification .notification-content {\n\tdisplay: flex;\n\talign-items: flex-start;\n\tpadding: 16px;\n\tgap: 12px;\n}\n\n#gemini-mapping-failure-notification .notification-icon {\n\tfont-size: 28px;\n\tflex-shrink: 0;\n}\n\n#gemini-mapping-failure-notification .notification-text {\n\tflex: 1;\n}\n\n#gemini-mapping-failure-notification .notification-text strong {\n\tdisplay: block;\n\tfont-size: 1.1em;\n\tmargin-bottom: 4px;\n}\n\n#gemini-mapping-failure-notification .notification-text p {\n\tmargin: 0;\n\tfont-size: 0.95em;\n\tline-height: 1.4;\n}\n\n#gemini-mapping-failure-notification .notification-close {\n\tbackground: none;\n\tborder: none;\n\tcolor: white;\n\tfont-size: 24px;\n\tcursor: pointer;\n\tpadding: 0;\n\twidth: 24px;\n\theight: 24px;\n\tline-height: 1;\n\tflex-shrink: 0;\n}\n\n#gemini-mapping-failure-notification .notification-close:hover {\n\topacity: 0.8;\n}\n",""]);const s=r},314:n=>{n.exports=function(n){var t=[];return t.toString=function(){return this.map(function(t){var e="",i=void 0!==t[5];return t[4]&&(e+="@supports (".concat(t[4],") {")),t[2]&&(e+="@media ".concat(t[2]," {")),i&&(e+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),e+=n(t),i&&(e+="}"),t[2]&&(e+="}"),t[4]&&(e+="}"),e}).join("")},t.i=function(n,e,i,o,a){"string"==typeof n&&(n=[[null,n,void 0]]);var r={};if(i)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(r[l]=!0)}for(var c=0;c<n.length;c++){var d=[].concat(n[c]);i&&r[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),e&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=e):d[2]=e),o&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=o):d[4]="".concat(o)),t.push(d))}},t}},355:(n,t,e)=>{e.d(t,{A:()=>s});var i=e(601),o=e.n(i),a=e(314),r=e.n(a)()(o());r.push([n.id,"/* Title area styling to accommodate the summary trigger */\n.title-wrap {\n\tposition: relative;\n\tpadding-right: 45px; /* Space for the summary trigger button */\n}\n\n/* Summary Icon and Tooltip */\n.gemini-summary-container {\n\t/* This container is now a direct child of the .card element */\n}\n\n.gemini-summary-trigger {\n\tposition: absolute;\n\ttop: 50%;\n\tright: 8px; /* Position within the title-wrap padding area */\n\ttransform: translateY(-50%);\n\tcursor: pointer;\n\tz-index: 5;\n\tbackground-color: rgb(0 0 0 / 60%);\n\tborder-radius: 50%;\n\twidth: 28px;\n\theight: 28px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tcolor: white;\n}\n\n.gemini-summary-trigger .material-icons {\n\tfont-size: 16px;\n}\n\n.gemini-summary-card {\n\tdisplay: none;\n\tposition: absolute;\n\ttop: 50%;\n\tright: calc(100% + 15px);\n\ttransform: translateY(-50%);\n\twidth: 400px;\n\tmax-height: 600px;\n\tbackground-color: #212529;\n\tborder: 1px solid #495057;\n\tborder-radius: 8px;\n\tpadding: 15px;\n\tz-index: 100;\n\tcolor: #f8f9fa;\n\tfont-size: 0.9em;\n\tbox-shadow: 0 6px 12px rgb(0 0 0 / 40%);\n\toverflow-y: auto;\n}\n\n.gemini-summary-card h4 {\n\tmargin: 0 0 8px;\n\tcolor: #fff;\n\tfont-size: 1.1em;\n\tfont-weight: 600;\n}\n\n.gemini-summary-card h5 {\n\tmargin: 10px 0 5px;\n\tcolor: #adb5bd;\n\tfont-size: 1em;\n\tfont-weight: 500;\n}\n\n.gemini-summary-card p {\n\tmargin: 0 0 10px;\n\tline-height: 1.4;\n}\n\n.gemini-summary-card .assessment-section {\n\tmargin-bottom: 12px;\n}\n\n.gemini-summary-card .assessment-grid {\n\tdisplay: grid;\n\tgrid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n\tgap: 8px;\n\tmargin-top: 8px;\n}\n\n.gemini-summary-card .assessment-item {\n\tfont-size: 0.85em;\n}\n\n.gemini-summary-card .summary-toggle {\n\tcursor: pointer;\n\tuser-select: none;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tbackground-color: rgb(255 255 255 / 5%);\n\tpadding: 8px 12px;\n\tborder-radius: 4px;\n\tmargin-bottom: 8px;\n\ttransition: background-color 0.2s ease;\n}\n\n.gemini-summary-card .summary-toggle:hover {\n\tbackground-color: rgb(255 255 255 / 10%);\n}\n\n.gemini-summary-card .summary-toggle .toggle-icon {\n\tfont-size: 1.2em;\n\ttransition: transform 0.2s ease;\n}\n\n.gemini-summary-card .summary-toggle.collapsed .toggle-icon {\n\ttransform: rotate(-90deg);\n}\n\n.gemini-summary-card .summary-content {\n\tmax-height: 0;\n\toverflow: hidden;\n\ttransition: max-height 0.3s ease;\n\tmargin-bottom: 10px;\n}\n\n.gemini-summary-card .summary-content.expanded {\n\tmax-height: 200px; /* Scrolling enabled for long content */\n\toverflow-y: auto;\n}\n\n.gemini-summary-card .summary-content p {\n\tmargin: 10px 0;\n\tline-height: 1.4;\n\tpadding: 0 12px;\n}\n\n.gemini-summary-card.locked {\n\tdisplay: block;\n}\n\n.gemini-summary-card:hover:not(.locked),\n.gemini-summary-trigger:hover + .gemini-summary-card:not(.locked) {\n\tdisplay: block;\n}\n",""]);const s=r},483:(n,t,e)=>{e.d(t,{A:()=>s});var i=e(601),o=e.n(i),a=e(314),r=e.n(a)()(o());r.push([n.id,'/* Material Icons font declarations */\n@font-face {\n\tfont-family: "Material Icons";\n\tfont-style: normal;\n\tfont-weight: 400;\n\tsrc: url("https://fonts.gstatic.com/s/materialicons/v145/flUhRq6tzZclQEJ-Vdg-IuiaDsNc.woff2") format("woff2");\n}\n\n@font-face {\n\tfont-family: "Material Icons Outlined";\n\tfont-style: normal;\n\tfont-weight: 400;\n\tsrc: url("https://fonts.gstatic.com/s/materialiconsoutlined/v110/gok-H7zzDkdnRel8-DQ6KAXJ69wP1tGnf4ZGhUcd.otf")\n\t\tformat("opentype");\n}\n\n@font-face {\n\tfont-family: "Material Icons Round";\n\tfont-style: normal;\n\tfont-weight: 400;\n\tsrc: url("https://fonts.gstatic.com/s/materialiconsround/v109/LDItaoyNOAY6Uewc665JcIzCKsKc_M9flwmM.otf")\n\t\tformat("opentype");\n}\n\n@font-face {\n\tfont-family: "Material Icons Sharp";\n\tfont-style: normal;\n\tfont-weight: 400;\n\tsrc: url("https://fonts.gstatic.com/s/materialiconssharp/v110/oPWQ_lt5nv4pWNJpghLP75WiFR4kLh3kvmvS.otf")\n\t\tformat("opentype");\n}\n\n@font-face {\n\tfont-family: "Material Icons Two Tone";\n\tfont-style: normal;\n\tfont-weight: 400;\n\tsrc: url("https://fonts.gstatic.com/s/materialiconstwotone/v113/hESh6WRmNCxEqUmNyh3JDeGxjVVyMg4tHGctNCu3.otf")\n\t\tformat("opentype");\n}\n\n/* Material Icons font declaration */\n.material-icons {\n\tfont-family: "Material Icons", sans-serif;\n\tfont-weight: normal;\n\tfont-style: normal;\n\tfont-size: 24px;\n\tline-height: 1;\n\tletter-spacing: normal;\n\ttext-transform: none;\n\tdisplay: inline-block;\n\twhite-space: nowrap;\n\toverflow-wrap: normal;\n\tdirection: ltr;\n\tfont-feature-settings: "liga";\n\t-webkit-font-smoothing: antialiased;\n}\n',""]);const s=r},532:(n,t,e)=>{e.d(t,{A:()=>s});var i=e(601),o=e.n(i),a=e(314),r=e.n(a)()(o());r.push([n.id,"/* Button Components */\n",""]);const s=r},538:(n,t,e)=>{e.d(t,{A:()=>s});var i=e(601),o=e.n(i),a=e(314),r=e.n(a)()(o());r.push([n.id,'/* Settings Panel */\n#gemini-settings-panel {\n\tdisplay: none;\n\tposition: fixed;\n\ttop: 50%;\n\tleft: 50%;\n\ttransform: translate(-50%, -50%);\n\tbackground-color: #2c3034;\n\tcolor: white;\n\tpadding: 20px;\n\tborder-radius: 8px;\n\tbox-shadow: 0 5px 15px rgb(0 0 0 / 50%);\n\tz-index: 9999;\n\tmax-width: 500px;\n\twidth: 100%;\n}\n\n#gemini-settings-panel h3 {\n\tmargin-top: 0;\n}\n\n#gemini-settings-panel label {\n\tdisplay: block;\n\tmargin: 10px 0 5px;\n}\n\n#gemini-settings-panel input,\n#gemini-settings-panel select {\n\twidth: 100%;\n\tpadding: 8px;\n\tborder-radius: 4px;\n\tborder: 1px solid #495057;\n\tbackground-color: #212529;\n\tcolor: white;\n\tbox-sizing: border-box;\n}\n\n/* Debug logging label with flexbox for checkbox alignment */\n#gemini-settings-panel .debug-logging-label {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 10px;\n}\n\n#gemini-settings-panel .debug-logging-label input[type="checkbox"] {\n\twidth: auto;\n\tmargin: 0;\n}\n\n#gemini-settings-panel .buttons {\n\tmargin-top: 20px;\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tgap: 10px;\n}\n\n/* Clear cache button pushed to the left */\n#gemini-settings-panel .clear-cache-btn {\n\tbackground-color: #dc3545;\n\tcolor: white;\n\tmargin-right: auto;\n}\n\n/* General button styling */\n#gemini-settings-panel button {\n\tpadding: 8px 15px;\n\tborder-radius: 4px;\n\tborder: none;\n\tcursor: pointer;\n}\n\n#gemini-settings-save {\n\tbackground-color: #0d6efd;\n\tcolor: white;\n}\n\n#gemini-settings-close {\n\tbackground-color: #6c757d;\n\tcolor: white;\n}\n\n/* API Key Modal */\n#gemini-api-key-modal {\n\tdisplay: none;\n\tposition: fixed;\n\ttop: 50%;\n\tleft: 50%;\n\ttransform: translate(-50%, -50%);\n\tbackground-color: #2c3034;\n\tcolor: white;\n\tpadding: 20px;\n\tborder-radius: 8px;\n\tbox-shadow: 0 5px 15px rgb(0 0 0 / 50%);\n\tz-index: 9999;\n\twidth: 100%;\n\tmax-width: 500px;\n\tmax-height: 80vh;\n\toverflow-y: auto;\n}\n\n#gemini-api-key-modal h3 {\n\tmargin-top: 0;\n\tcolor: #fff;\n\ttext-align: center;\n}\n\n#gemini-api-key-modal .instructions {\n\tmargin-bottom: 20px;\n}\n\n#gemini-api-key-modal .instructions ol {\n\ttext-align: left;\n\tpadding-left: 20px;\n}\n\n#gemini-api-key-modal .instructions li {\n\tmargin-bottom: 8px;\n}\n\n#gemini-api-key-modal label {\n\tdisplay: block;\n\tmargin: 10px 0 5px;\n\tfont-weight: bold;\n}\n\n#gemini-api-key-modal input {\n\twidth: 100%;\n\tpadding: 8px;\n\tborder-radius: 4px;\n\tborder: 1px solid #495057;\n\tbackground-color: #212529;\n\tcolor: white;\n\tbox-sizing: border-box;\n}\n\n#gemini-api-key-modal .buttons {\n\tmargin-top: 20px;\n\tdisplay: flex;\n\tjustify-content: flex-end;\n}\n\n#gemini-api-key-modal button {\n\tmargin: 0 0 0 10px;\n\tpadding: 8px 15px;\n\tborder-radius: 4px;\n\tborder: none;\n\tcursor: pointer;\n\tbackground-color: #0d6efd;\n\tcolor: white;\n}\n\n#gemini-api-key-modal-close {\n\tbackground-color: #6c757d;\n}\n',""]);const s=r},540:n=>{n.exports=function(n){var t=document.createElement("style");return n.setAttributes(t,n.attributes),n.insert(t,n.options),t}},601:n=>{n.exports=function(n){return n[1]}},659:n=>{var t={};n.exports=function(n,e){var i=function(n){if(void 0===t[n]){var e=document.querySelector(n);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(n){e=null}t[n]=e}return t[n]}(n);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(e)}},731:(n,t,e)=>{e.d(t,{A:()=>s});var i=e(601),o=e.n(i),a=e(314),r=e.n(a)()(o());r.push([n.id,"/* Color-coded Username Styling */\n.username-color-coded {\n\tbackground-color: rgb(255 255 255 / 10%);\n\tpadding: 1px 3px;\n\tborder-radius: 2px;\n\tfont-weight: 600;\n\ttransition: all 0.2s ease;\n\tborder: 1px solid transparent;\n}\n\n.username-color-coded:hover {\n\tbackground-color: rgb(255 255 255 / 20%);\n\tborder-color: rgb(255 255 255 / 30%);\n\ttransform: translateY(-1px);\n}\n\n/* Anonymous user styling */\n.username-color-coded.anonymous {\n\tbackground-color: rgb(149 165 166 / 20%);\n\tcolor: #bdc3c7 !important;\n\tborder: 1px solid rgb(189 195 199 / 30%);\n}\n",""]);const s=r},825:n=>{n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=n.insertStyleElement(n);return{update:function(e){!function(n,t,e){var i="";e.supports&&(i+="@supports (".concat(e.supports,") {")),e.media&&(i+="@media ".concat(e.media," {"));var o=void 0!==e.layer;o&&(i+="@layer".concat(e.layer.length>0?" ".concat(e.layer):""," {")),i+=e.css,o&&(i+="}"),e.media&&(i+="}"),e.supports&&(i+="}");var a=e.sourceMap;a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(i,n,t.options)}(t,n,e)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(t)}}}},933:(n,t,e)=>{e.d(t,{A:()=>s});var i=e(601),o=e.n(i),a=e(314),r=e.n(a)()(o());r.push([n.id,"/* Card modifications */\n.gemini-good-novel .card-body {\n\tbackground-color: #2e462e !important;\n\tborder: 1px solid #578857;\n} /* Dark Green */\n\n.gemini-mixed-novel .card-body {\n\tbackground-color: #46402e !important;\n\tborder: 1px solid #887a57;\n} /* Dark Yellow/Orange */\n\n.gemini-bad-novel .card-body {\n\tbackground-color: #462e2e !important;\n\tborder: 1px solid #885757;\n} /* Dark Red */\n\n.gemini-processing-overlay {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: rgb(0 0 0 / 50%);\n\tcolor: white;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-size: 1.2em;\n\tz-index: 10;\n\tborder-radius: var(--bs-card-inner-border-radius);\n}\n",""]);const s=r}},t={};function e(i){var o=t[i];if(void 0!==o)return o.exports;var a=t[i]={id:i,exports:{}};return n[i](a,a.exports,e),a.exports}e.n=n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},e.d=(n,t)=>{for(var i in t)e.o(t,i)&&!e.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:t[i]})},e.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t),e.nc=void 0;const i=["gemini-2.5-pro","gemini-flash-latest","gemini-flash-lite-latest","gemini-2.5-flash","gemini-2.5-flash-lite"],o=1e3,a=["#e74c3c","#3498db","#2ecc71","#f39c12","#9b59b6","#1abc9c","#e67e22","#34495e","#e91e63","#ff5722","#795548","#607d8b","#8bc34a","#ffc107","#673ab7","#00bcd4","#ff9800","#4caf50","#2196f3","#f44336","#9c27b0"],r="gemini-2.5-flash",s=!1;let l={apiKey:"",geminiModel:r,debugLoggingEnabled:s};function c(n){GM_setValue("geminiApiKey",n.apiKey),GM_setValue("geminiModel",n.geminiModel),GM_setValue("debugLoggingEnabled",n.debugLoggingEnabled),l={...n}}function d(){return{...l}}function m(){return l.apiKey}function g(n){return new Promise(t=>setTimeout(t,n))}function p(n,t){l.debugLoggingEnabled&&console.log(`[WTR-Lab Novel Reviewer Debug] ${n}`,t||"")}const u=new Map;let f=!1;async function h(){p("Building serie_id mapping from __NEXT_DATA__");const n=document.querySelector('script[id="__NEXT_DATA__"]');if(!n)return console.warn("__NEXT_DATA__ script not found. Unable to build serie_id mapping."),!1;try{const t=JSON.parse(n.textContent);return t.props?.pageProps?.list&&t.props.pageProps.list.forEach(n=>{n.raw_id&&n.serie_id&&u.set(n.raw_id.toString(),n.serie_id.toString())}),p(`Built serie_id map with ${u.size} entries`),0!==u.size||(console.error("Serie ID mapping failed: Map is empty after building"),!1)}catch(n){return console.error("Error parsing __NEXT_DATA__:",n),!1}}function y(n,t){return t&&null!=t&&""!==t?/^\d+$/.test(t.toString())?(p(`Mapping validation SUCCESS: raw_id ${n} -> serie_id ${t}`),!0):(p(`Mapping validation FAILED: Invalid serie_id format "${t}" for raw_id ${n}`),!1):(p(`Mapping validation FAILED: Invalid serie_id for raw_id ${n}`),!1)}function b(n){return u.get(n)||null}function v(){if(f)return;f=!0;const n=window.__ICON_REPLACEMENTS__?"material-icons-fallback":"material-icons",t=window.__ICON_REPLACEMENTS__?"⚠️":"error",e=document.createElement("div");e.id="gemini-mapping-failure-notification",e.innerHTML=`\n\t\t<div class="notification-content">\n\t\t\t<span class="${n} notification-icon">${t}</span>\n\t\t\t<div class="notification-text">\n\t\t\t\t<strong>Serie ID Mapping Failed</strong>\n\t\t\t\t<p>Unable to map novel IDs correctly. Please refresh the page to retry.</p>\n\t\t\t</div>\n\t\t\t<button class="notification-close" onclick="this.parentElement.parentElement.remove()">×</button>\n\t\t</div>\n\t`,document.body.appendChild(e),console.error("MAPPING FAILURE: User has been notified to refresh the page"),p("Mapping failure notification displayed to user")}function w(){try{const n="__localStorage_test__";return localStorage.setItem(n,"test"),localStorage.removeItem(n),!0}catch(n){return!1}}function x(n){return`geminiAssessment_${n}`}function A(n){if(!w())return null;try{const t=x(n),e=localStorage.getItem(t);if(e){const n=JSON.parse(e);if(n&&"object"==typeof n&&n.assessment)return n}}catch(t){console.warn("Error retrieving cached assessment for serieId:",n,t)}return null}const k=new Map;function S(n){const t=new Set;return n.forEach(n=>{if(n.username){const e=n.username.trim();e&&"null"!==e&&"undefined"!==e&&t.add(e)}}),Array.from(t)}function E(n){if(!n)return"";const t=n.toLowerCase();return t.includes("good")||t.includes("excellent")||t.includes("outstanding")||t.includes("very good")||t.includes("strong")?"good":t.includes("mixed")||t.includes("average")||t.includes("decent")||t.includes("fair")||t.includes("moderate")?"mixed":t.includes("bad")||t.includes("poor")||t.includes("weak")||t.includes("lacking")||t.includes("needs improvement")?"bad":t.includes("unknown")||t.includes("missing")||t.includes("unspecified")||t.includes("undetermined")||t.includes("insufficient")?"unknown":""}function I(n,t){const e=t&&t.assessment&&t.summary;if(e){const e=(t=function(n){return n.unknown||(n.unknown="Mixed"),n}(t)).assessment.toLowerCase();"good"===e?n.classList.add("gemini-good-novel"):"mixed"===e?n.classList.add("gemini-mixed-novel"):"bad"===e&&n.classList.add("gemini-bad-novel")}const i=window.__ICON_REPLACEMENTS__?{iconClass:"material-icons-fallback",expandIcon:"▼",autoAwesomeIcon:"⭐"}:{iconClass:"material-icons",expandIcon:"expand_more",autoAwesomeIcon:"auto_awesome"},r=document.createElement("div");r.className="gemini-summary-container";let s=null;if(e){const n=E(t.assessment),e=E(t.characterDevelopment),o=E(t.plotStructure),l=E(t.worldBuilding),c=E(t.themesAndMessages),d=E(t.writingStyle),m=E(t.unknown),g=t.availableUsernames||[];let p="<h4>AI Novel Assessment</h4>";p+='<div class="summary-toggle collapsed" data-target="novel-summary">',p+="<span>Novel Summary</span>",p+=`<span class="${i.iconClass} toggle-icon">${i.expandIcon}</span>`,p+="</div>",p+='<div class="summary-content" id="novel-summary">',p+=`<p>${t.novelSummary}</p>`,p+="</div>";const u=function(n,t){if(!n||!t||0===t.length)return n;let e=n;return[...t].sort((n,t)=>t.length-n.length).forEach(n=>{const t=function(n){if(!n||"null"===n||"undefined"===n||""===n.trim())return"#95a5a6";if(k.has(n))return k.get(n);let t=0;for(let e=0;e<n.length;e++)t=(t<<5)-t+n.charCodeAt(e),t&=t;const e=Math.abs(t)%a.length,i=a[e];return k.set(n,i),i}(n),i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=new RegExp(`\\b${i}\\b`,"gi"),r=n&&"null"!==n&&"undefined"!==n&&""!==n.trim()?"username-color-coded":"username-color-coded anonymous";e=e.replace(o,n=>`<span class="${r}" style="color: ${t}; font-weight: 600;">${n}</span>`)}),e}(t.reviewSummary,g);p+='<div class="summary-toggle collapsed" data-target="review-summary">',p+="<span>Review Summary</span>",p+=`<span class="${i.iconClass} toggle-icon">${i.expandIcon}</span>`,p+="</div>",p+='<div class="summary-content" id="review-summary">',p+=`<p>${u}</p>`,p+="</div>",p+='<div class="assessment-section">',p+=`<strong>Overall Assessment:</strong> <span class="assessment-rating ${n}">${t.assessment}</span><br><hr style="margin: 5px 0;">`,p+=`<strong>Analysis Summary:</strong> ${t.summary}<br><hr style="margin: 5px 0;">`,t.characterDevelopment&&(p+=`<strong>Character Development:</strong> <span class="assessment-rating ${e}">${"Unknown"===t.characterDevelopment?"Insufficient Data":t.characterDevelopment}</span><br>`),t.plotStructure&&(p+=`<strong>Plot Structure:</strong> <span class="assessment-rating ${o}">${"Unknown"===t.plotStructure?"Insufficient Data":t.plotStructure}</span><br>`),t.worldBuilding&&(p+=`<strong>World-Building:</strong> <span class="assessment-rating ${l}">${"Unknown"===t.worldBuilding?"Insufficient Data":t.worldBuilding}</span><br>`),t.themesAndMessages&&(p+=`<strong>Themes & Messages:</strong> <span class="assessment-rating ${c}">${"Unknown"===t.themesAndMessages?"Insufficient Data":t.themesAndMessages}</span><br>`),t.writingStyle&&(p+=`<strong>Writing Style:</strong> <span class="assessment-rating ${d}">${"Unknown"===t.writingStyle?"Insufficient Data":t.writingStyle}</span><br>`),t.unknown&&"Mixed"!==t.unknown&&(p+=`<strong>Legacy Unknown Data:</strong> <span class="assessment-rating ${m}">${t.unknown}</span><br>`),p+="</div>",r.innerHTML=`\n\t\t\t<div class="gemini-summary-card">\n\t\t\t\t${p}\n\t\t\t</div>\n\t\t`,s=r.querySelector(".gemini-summary-card")}const f=n.querySelector(".title-wrap"),h=document.createElement("div");h.className="gemini-summary-trigger",h.title=e?"Show AI Summary":"Analyze Novel",h.innerHTML=`<span class="${i.iconClass}">${i.autoAwesomeIcon}</span>`;let M=!1;h.addEventListener("click",function(n){n.stopPropagation(),e?(M=!M,M?s.classList.add("locked"):s.classList.remove("locked")):async function(){if(!m()&&!await new Promise(n=>{document.getElementById("gemini-api-key-modal-input").value="",document.getElementById("gemini-api-key-modal").style.display="block";const t=document.getElementById("gemini-api-key-modal-save"),e=document.getElementById("gemini-api-key-modal-close");t.addEventListener("click",()=>{const t=document.getElementById("gemini-api-key-modal-input").value.trim();t?(c({...d(),apiKey:t}),document.getElementById("gemini-api-key-modal").style.display="none",n(!0)):alert("Please enter a valid API key.")},{once:!0}),e.addEventListener("click",()=>{document.getElementById("gemini-api-key-modal").style.display="none",n(!1)},{once:!0})}))return;if(0===u.size)return console.error("PROCESSING HALTED: Serie ID map is empty. Cannot proceed with invalid mappings."),p("Processing aborted: Serie ID map validation failed (empty map)"),void v();const n=Array.from(document.querySelectorAll(".series-list > .card")),t=[];for(const e of n){const n=e.querySelector("a[data-novel-id]");let i=null,o=null;if(n){if(o=n.dataset.novelId,!o){console.warn(`No serie_id mapping found for raw_id ${o}. Skipping this novel.`),p(`Skipping novel with raw_id ${o}: No mapping in serieIdMap`);continue}if(i=b(o),i&&!y(o,i))return console.error(`PROCESSING HALTED: Invalid serie_id mapping detected for raw_id ${o}`),p(`Processing aborted: Mapping validation failed for raw_id ${o}`),void v()}i&&!A(i)&&t.push(e)}if(0===t.length)return void alert("No new novels to analyze.");const e=t.slice(0,1),i=e.map(n=>function(n){const t=document.createElement("div");t.className="gemini-processing-overlay",t.textContent="Analyzing...";const e=n.querySelector(".card-body");return e&&(e.style.position="relative",e.appendChild(t)),t}(n));try{const n=await async function(n,t){const e=[],i=[];for(let o=0;o<n.length;o++){const a=n[o],r=t[o],s=a.querySelector("a[data-novel-id]");let l=null,c=null;if(s&&(c=s.dataset.novelId,c)){if(l=b(c),!l)throw console.error(`PROCESSING HALTED: No serie_id mapping for raw_id ${c}`),v(),t.forEach(n=>n&&n.remove()),new Error("No serie_id mapping found");if(!y(c,l))throw console.error(`PROCESSING HALTED: Invalid serie_id "${l}" for raw_id ${c}`),v(),t.forEach(n=>n&&n.remove()),new Error("Invalid serie_id mapping detected")}if(!l)throw console.error("PROCESSING HALTED: Unable to obtain valid serie_id"),v(),t.forEach(n=>n&&n.remove()),new Error("No valid serie_id available");const d=a.querySelector("a.title");let m=d?d.textContent.trim():"No title";d&&m.startsWith("#")&&(m=m.split(" ").slice(1).join(" "));const p=d?d.querySelector(".rawtitle"):null;p&&(m=m.replace(p.textContent,"").trim());const u=a.querySelector(".detail-buttons .detail-line:nth-of-type(1)");let f=0;if(u){const n=u.textContent.match(/(\d+) views/);n&&(f=parseInt(n[1],10))}const h=a.querySelector(".detail-buttons .detail-line:nth-of-type(2)");let w=0;if(h){const n=h.textContent.match(/(\d+) Readers/);n&&(w=parseInt(n[1],10))}const x=a.querySelector(".rating-text");let A=0;if(x){const n=x.textContent.match(/(\d+\.\d+)/);n&&(A=parseFloat(n[1]))}const k=a.querySelectorAll(".genres .genre"),E=Array.from(k).map(n=>n.textContent.trim()),I=a.querySelector(".description")?.textContent.trim()||"No description.",_=(await $(l)).filter(n=>n.comment),M=_.map(n=>`- User: ${n.username||"Unknown"}\n- Rating: ${n.rate}/5\n- Comment: ${n.comment}`).join("\n\n"),C=S(_);e.push({serieId:l,title:m,totalViews:f,totalReaders:w,rating:A,genres:E,description:I,reviewsText:M,availableUsernames:C}),i.push({card:a,overlay:r,serieId:l}),await g(300)}if(0===e.length)return{batchResults:i,novelsData:[]};const a=await function(n){const t=`\n\t              Analyze the following list of novels. For each novel, use its title, view count, reader count, rating, genres, description, and user reviews to provide a comprehensive assessment across multiple categories.\n\t              Return a single JSON array. Each object in the array must correspond to a novel in the input list, maintaining the original order.\n\n\t              For each novel, provide:\n\t              1. A novel summary: A concise 2-3 sentence summary of what the novel is about, based primarily on the title, description, genres, and user reviews.\n\t              2. A review summary: A balanced summary of user feedback from the reviews, including positive and negative points, with proper attribution to usernames (e.g., "According to [User], ..."). Use EXACT usernames from the availableUsernames list when making attributions.\n\n\t              Then provide detailed assessments in the following categories:\n\t              - Overall assessment (Good/Mixed/Bad)\n\t              - Character Development (Good/Mixed/Bad/Unknown)\n\t              - Plot Structure (Good/Mixed/Bad/Unknown)\n\t              - World-Building (Good/Mixed/Bad/Unknown)\n\t              - Themes & Messages (Good/Mixed/Bad/Unknown)\n\t              - Writing Style (Good/Mixed/Bad/Unknown)\n\n\t              For each category, include specific criteria:\n\t              - Character Development: character depth, growth, consistency, dialogue authenticity, relationship dynamics\n\t              - Plot Structure: pacing, narrative flow, story coherence, conflict resolution, foreshadowing\n\t              - World-Building: setting details, consistency, immersion, cultural depth, originality\n\t              - Themes & Messages: clarity, relevance, integration, thought provocation, balance\n\t              - Writing Style: prose quality, descriptive language, dialogue naturalness, grammar, technical execution\n\n\t              CRITICAL: Each category can be rated as "Unknown" when:\n\t              - Character Development: No character development information found in available data\n\t              - Plot Structure: No plot structure information found in available data\n\t              - World-Building: No world-building details found in available data\n\t              - Themes & Messages: No theme or message information found in available data\n\t              - Writing Style: No writing style information found in available data\n\n\t              Important distinctions:\n\t              - "Unknown" means: insufficient data to make a reliable assessment for that specific aspect\n\t              - "Bad" means: poor quality or problematic implementation of that aspect\n\t              - Use "Unknown" when data is genuinely missing or insufficient, NOT when quality is poor\n\n\t              Novels List:\n\t              ${JSON.stringify(n,null,2)}\n\t      `,e=JSON.stringify({contents:[{parts:[{text:t}]}],generationConfig:{responseMimeType:"application/json",responseJsonSchema:{type:"array",items:{type:"object",properties:{novelSummary:{type:"string",description:"A concise 2-3 sentence summary of what the novel is about."},reviewSummary:{type:"string",description:"A balanced summary of user feedback with proper username attribution."},assessment:{type:"string",enum:["Good","Mixed","Bad"]},summary:{type:"string",description:"A brief 2-3 sentence summary explaining the overall assessment."},characterDevelopment:{type:"string",enum:["Good","Mixed","Bad","Unknown"]},plotStructure:{type:"string",enum:["Good","Mixed","Bad","Unknown"]},worldBuilding:{type:"string",enum:["Good","Mixed","Bad","Unknown"]},themesAndMessages:{type:"string",enum:["Good","Mixed","Bad","Unknown"]},writingStyle:{type:"string",enum:["Good","Mixed","Bad","Unknown"]}},required:["novelSummary","reviewSummary","assessment","summary","characterDevelopment","plotStructure","worldBuilding","themesAndMessages","writingStyle"]}},temperature:.3},safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]});return p("Gemini Prompt:",t),new Promise((n,t)=>{let i=0;const a=()=>{const r=m(),s=l.geminiModel;GM_xmlhttpRequest({method:"POST",url:`https://generativelanguage.googleapis.com/v1beta/models/${s}:generateContent?key=${r}`,headers:{"Content-Type":"application/json"},data:e,onload:function(e){try{const r=JSON.parse(e.responseText);if(p("Gemini Raw Response:",r),r.candidates&&r.candidates.length>0){const t=JSON.parse(r.candidates[0].content.parts[0].text);n(t)}else{const n=r.promptFeedback?`Gemini block reason: ${JSON.stringify(r.promptFeedback)}`:"Gemini API returned no candidates.";if(console.error("Gemini API Response Error:",r),i<3){i++;const t=o*Math.pow(2,i-1);console.warn(`Retrying Gemini request in ${t}ms (Attempt ${i}/3). Error: ${n}`),setTimeout(a,t)}else t(`Gemini API failed after 3 retries. Last error: ${n}`)}}catch(n){if(i<3){i++;const t=o*Math.pow(2,i-1);console.warn(`Retrying Gemini request in ${t}ms (Attempt ${i}/3). Error: Failed to parse response: ${n}`),setTimeout(a,t)}else t(`Failed to parse Gemini response after 3 retries: ${n}\nResponse: ${e.responseText}`)}},onerror:n=>{if(i<3){i++;const t=o*Math.pow(2,i-1);console.warn(`Retrying Gemini request in ${t}ms (Attempt ${i}/3). Error: API request failed: ${n.statusText}`),setTimeout(a,t)}else t(`Gemini API request failed after 3 retries: ${n.statusText}`)}})};a()})}(e);if(a.length!==e.length)throw new Error("Mismatch between number of novels sent and analyses received.");return i.forEach(({card:n,overlay:t,serieId:i},o)=>{let r=a[o];const s=e[o];r&&(!r.availableUsernames&&s&&s.availableUsernames&&(r.availableUsernames=s.availableUsernames),r=_(r),I(n,r),function(n,t){if(w())try{const e=x(n);localStorage.setItem(e,JSON.stringify(t))}catch(t){"QuotaExceededError"===t.name?console.warn("Local storage quota exceeded, unable to cache assessment for serieId:",n):console.warn("Error caching assessment for serieId:",n,t)}}(i,r),n.dataset.geminiProcessed="true"),t&&t.remove()}),{batchResults:i,novelsData:e}}(e,i);0===n.novelsData.length&&p("Novel was cached - no API call needed")}catch(n){console.error("An error occurred during single novel processing:",n),i.forEach(n=>{n&&(n.textContent="Processing Failed",setTimeout(()=>n.remove(),4e3))})}}()}),e&&s.querySelectorAll(".summary-toggle").forEach(n=>{n.addEventListener("click",function(){const n=this.dataset.target,t=s.querySelector(`#${n}`);this.classList.contains("collapsed")?(this.classList.remove("collapsed"),t.classList.add("expanded")):(this.classList.add("collapsed"),t.classList.remove("expanded"))})}),f&&f.appendChild(h),n.appendChild(r)}function _(n){return n.unknown||(n.unknown="Mixed"),n}async function $(n){let t=[];const e=`https://wtr-lab.com/api/review/get?serie_id=${n}&page=0&sort=most_liked`;p(`Fetching reviews for serieId ${n}, Page 0 from: ${e}`);try{const i=await fetch(e);if(!i.ok)return p(`Review API response not OK for ${n}. Status: ${i.status}`),[];const o=await i.json();if(p(`Review API raw data for ${n}, Page 0:`,o),!(o.success&&o.data&&o.data.length>0))return p(`No reviews found in page 0 for ${n}`),[];{t=t.concat(o.data),p(`Page 0 received ${o.data.length} reviews for ${n}`);const e=o.data.filter(n=>n.comment);if(e.length>=3)return p(`Page 0 has sufficient data (${e.length} reviews with comments) for ${n} - stopping here`),t}}catch(t){return console.error(`Error fetching reviews for serie_id ${n} on page 0:`,t),[]}for(let e=1;e<5;e++){const i=`https://wtr-lab.com/api/review/get?serie_id=${n}&page=${e}&sort=most_liked`;p(`Fetching reviews for serieId ${n}, Page ${e} from: ${i}`);try{const o=await fetch(i);if(!o.ok){p(`Review API response not OK for ${n}. Status: ${o.status}`);break}const a=await o.json();if(p(`Review API raw data for ${n}, Page ${e}:`,a),!(a.success&&a.data&&a.data.length>0))break;t=t.concat(a.data)}catch(t){console.error(`Error fetching reviews for serie_id ${n} on page ${e}:`,t);break}await g(100)}return t}var M=e(72),C=e.n(M),T=e(825),N=e.n(T),P=e(659),L=e.n(P),G=e(56),R=e.n(G),D=e(540),U=e.n(D),B=e(113),O=e.n(B),z=e(483),q={};q.styleTagTransform=O(),q.setAttributes=R(),q.insert=L().bind(null,"head"),q.domAPI=N(),q.insertStyleElement=U(),C()(z.A,q),z.A&&z.A.locals&&z.A.locals;var F=e(229),j={};j.styleTagTransform=O(),j.setAttributes=R(),j.insert=L().bind(null,"head"),j.domAPI=N(),j.insertStyleElement=U(),C()(F.A,j),F.A&&F.A.locals&&F.A.locals;var H=e(933),K={};K.styleTagTransform=O(),K.setAttributes=R(),K.insert=L().bind(null,"head"),K.domAPI=N(),K.insertStyleElement=U(),C()(H.A,K),H.A&&H.A.locals&&H.A.locals;var J=e(193),W={};W.styleTagTransform=O(),W.setAttributes=R(),W.insert=L().bind(null,"head"),W.domAPI=N(),W.insertStyleElement=U(),C()(J.A,W),J.A&&J.A.locals&&J.A.locals;var V=e(355),Y={};Y.styleTagTransform=O(),Y.setAttributes=R(),Y.insert=L().bind(null,"head"),Y.domAPI=N(),Y.insertStyleElement=U(),C()(V.A,Y),V.A&&V.A.locals&&V.A.locals;var X=e(731),Q={};Q.styleTagTransform=O(),Q.setAttributes=R(),Q.insert=L().bind(null,"head"),Q.domAPI=N(),Q.insertStyleElement=U(),C()(X.A,Q),X.A&&X.A.locals&&X.A.locals;var Z=e(532),nn={};nn.styleTagTransform=O(),nn.setAttributes=R(),nn.insert=L().bind(null,"head"),nn.domAPI=N(),nn.insertStyleElement=U(),C()(Z.A,nn),Z.A&&Z.A.locals&&Z.A.locals;var tn=e(538),en={};en.styleTagTransform=O(),en.setAttributes=R(),en.insert=L().bind(null,"head"),en.domAPI=N(),en.insertStyleElement=U(),C()(tn.A,en),tn.A&&tn.A.locals&&tn.A.locals;var on=e(279),an={};an.styleTagTransform=O(),an.setAttributes=R(),an.insert=L().bind(null,"head"),an.domAPI=N(),an.insertStyleElement=U(),C()(on.A,an),on.A&&on.A.locals&&on.A.locals;var rn=e(41),sn={};async function ln(){l.apiKey=GM_getValue("geminiApiKey",""),GM_getValue("batchLimit","1"),l.geminiModel=GM_getValue("geminiModel",r),l.debugLoggingEnabled=GM_getValue("debugLoggingEnabled",s),await async function(){for(let n=1;n<=3;n++){if(p(`Attempting to build serie_id map (Attempt ${n}/3)`),await h())return p("Serie ID mapping validation: SUCCESS"),!0;console.warn(`Serie ID mapping failed on attempt ${n}/3`),n<3&&(p("Retrying in 2000ms..."),await g(2e3))}return console.error("Serie ID mapping validation: FAILED after all retry attempts"),!1}()||(console.error("INITIALIZATION FAILED: Unable to build serie_id mapping after all retries"),v()),function(){const n=`\n\t<div id="gemini-settings-panel">\n\t\t<h3>Gemini Reviewer Settings</h3>\n\t\t<label for="gemini-api-key-input">Gemini API Key:</label>\n\t\t<input type="password" id="gemini-api-key-input">\n\t\t<label for="gemini-model-select">Gemini Model:</label>\n\t\t<select id="gemini-model-select">${i.map(n=>`<option value="${n}">${n}</option>`).join("")}</select>\n\t\t<label for="gemini-debug-logging-input" class="debug-logging-label">\n\t\t\t<input type="checkbox" id="gemini-debug-logging-input">\n\t\t\tEnable Debug Logging (Logs prompts and responses)\n\t\t</label>\n\t\t<div class="buttons">\n\t\t\t<button id="clear-cache-button" class="clear-cache-btn">Clear Analyzed Novel Cache</button>\n\t\t\t<button id="gemini-settings-close">Close</button>\n\t\t\t<button id="gemini-settings-save">Save</button>\n\t\t</div>\n\t</div>\n`;document.body.insertAdjacentHTML("beforeend",n)}(),document.body.insertAdjacentHTML("beforeend",'\n\t\t<div id="gemini-api-key-modal">\n\t\t\t<h3>How to Get Your FREE Gemini API Token</h3>\n\t\t\t<div class="instructions">\n\t\t\t\t<ol>\n\t\t\t\t\t<li>Go to <a href="https://aistudio.google.com/" target="_blank" style="color: #0d6efd;">Google AI Studio</a></li>\n\t\t\t\t\t<li>Sign in with your Google account</li>\n\t\t\t\t\t<li>Click "Get API key in Google AI Studio"</li>\n\t\t\t\t\t<li>Create a new API key or use an existing one</li>\n\t\t\t\t\t<li>Copy the API key and paste it below</li>\n\t\t\t\t</ol>\n\t\t\t</div>\n\t\t\t<label for="gemini-api-key-modal-input">Gemini API Key:</label>\n\t\t\t<input type="password" id="gemini-api-key-modal-input" placeholder="Enter your Gemini API key here">\n\t\t\t<div class="buttons">\n\t\t\t\t<button id="gemini-api-key-modal-close">Cancel</button>\n\t\t\t\t<button id="gemini-api-key-modal-save">Save & Continue</button>\n\t\t\t</div>\n\t\t</div>\n\t'),GM_registerMenuCommand("Open Settings",()=>{const n=d();document.getElementById("gemini-api-key-input").value=n.apiKey,document.getElementById("gemini-model-select").value=n.geminiModel,document.getElementById("gemini-debug-logging-input").checked=n.debugLoggingEnabled,document.getElementById("gemini-settings-panel").style.display="block"}),document.getElementById("gemini-settings-save").addEventListener("click",()=>{c({apiKey:document.getElementById("gemini-api-key-input").value,geminiModel:document.getElementById("gemini-model-select").value,debugLoggingEnabled:document.getElementById("gemini-debug-logging-input").checked}),alert("Settings saved."),document.getElementById("gemini-settings-panel").style.display="none"}),document.getElementById("gemini-settings-close").addEventListener("click",()=>{document.getElementById("gemini-settings-panel").style.display="none"}),document.getElementById("clear-cache-button").addEventListener("click",()=>{confirm("Are you sure you want to clear the cache for all analyzed novels? This action cannot be undone.")&&(function(){if(!w())return!1;try{const n="geminiAssessment_";let t=0,e=0;const i=[];for(let n=0;n<localStorage.length;n++){const t=localStorage.key(n);t&&i.push(t)}for(const o of i)if(o.startsWith(n))try{localStorage.removeItem(o),t++}catch(n){console.warn("Error removing cached assessment key:",o,n),e++}return console.log(`Cleared ${t} cached assessments from localStorage`),e>0&&console.warn(`Encountered ${e} errors while clearing cached assessments`),0===e}catch(n){return console.warn("Error clearing all cached assessments:",n),!1}}()?(alert("Cache cleared successfully. Refreshing page..."),window.location.reload()):alert("Failed to clear cache. Check console for details."))}),new MutationObserver(()=>{document.querySelector(".series-list")&&Array.from(document.querySelectorAll(".series-list > .card:not([data-gemini-processed]):not([data-gemini-cached-checked])")).forEach(n=>{const t=n.querySelector("a[data-novel-id]");let e=null,i=null;if(t)if(i=t.dataset.novelId,i)e=b(i);else{if(t.href){const n=t.href.match(/\/novel\/(\d+)\//);n&&n[1]&&(e=n[1])}!e&&i&&(e=i)}let o=null;e&&(o=A(e),o&&(o.availableUsernames||(o.availableUsernames=[]),o=_(o))),I(n,o),n.dataset.geminiCachedChecked="true"})}).observe(document.body,{childList:!0,subtree:!0})}sn.styleTagTransform=O(),sn.setAttributes=R(),sn.insert=L().bind(null,"head"),sn.domAPI=N(),sn.insertStyleElement=U(),C()(rn.A,sn),rn.A&&rn.A.locals&&rn.A.locals,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",ln):ln()})();